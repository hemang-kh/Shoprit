<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHOPRIT - My Account</title>
    <!-- Link to Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Link to your existing main stylesheet -->
    <link rel="stylesheet" href="styles/style.css">
    <!-- Link to Google Fonts (Poppins, consistent with your site) -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for message box (copied from your index.html) */
        .message-box {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%) scale(0);
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
                                0 2px 4px -1px rgba(0, 0, 0, 0.06);
            color: white;
            text-align: center;
            z-index: 1000;
            transition: all 0.3s ease-in-out;
            opacity: 0;
        }
        .message-box.scale-100 {
            transform: translateX(-50%) scale(1);
            opacity: 1;
        }
        .bg-green-500 { background-color: #22c55e; }
        .bg-red-500 { background-color: #ef4444; }
        .bg-orange-500 { background-color: #f97316; }
        .bg-blue-500 { background-color: #3b82f6; }

        /* Account page specific styling */
        .account-container {
            min-height: calc(100vh - 120px); /* Adjust for header/footer height */
            background-color: #f0f2f5; /* Lighter background for account page */
            padding: 40px 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align items to the top */
        }

        .account-dashboard {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1200px; /* Max width for content */
            gap: 30px; /* Space between sections */
        }

        @media (min-width: 768px) {
            .account-dashboard {
                flex-direction: row; /* Two columns on larger screens */
                align-items: flex-start;
            }
        }

        .sidebar {
            flex: 0 0 250px; /* Fixed width for sidebar on desktop */
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 30px 20px;
            text-align: center;
            margin-bottom: 30px; /* Space below sidebar on mobile */
        }

        @media (min-width: 768px) {
            .sidebar {
                margin-bottom: 0; /* No bottom margin on desktop */
            }
        }

        .sidebar-profile {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #6366f1;
            margin-bottom: 15px;
            overflow: hidden; /* Ensure image fits */
        }
        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-name {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 5px;
        }

        .profile-email {
            font-size: 0.9rem;
            color: #777;
        }

        .sidebar-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-nav li {
            margin-bottom: 10px;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            color: #555;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
            font-size: 1rem;
        }

        .sidebar-nav a:hover {
            background-color: #eef2ff; /* Light purple */
            color: #6366f1;
            transform: translateX(5px);
        }

        .sidebar-nav a.active {
            background-color: #6366f1;
            color: white;
            box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3);
        }

        .sidebar-nav a.active:hover {
            background-color: #4f46e5;
            transform: translateX(0);
        }

        .main-content {
            flex: 1; /* Takes remaining space */
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 40px;
        }

        .content-section {
            display: none; /* Hidden by default */
        }
        .content-section.active {
            display: block; /* Shown when active */
        }

        .main-content h2 {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 2rem;
            color: #333;
            margin-bottom: 25px;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .dashboard-card {
            background-color: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        .dashboard-card h3 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.25rem;
            color: #6366f1;
            margin-bottom: 10px;
        }
        .dashboard-card p {
            font-size: 0.95rem;
            color: #666;
        }

        .btn-logout {
            display: block; /* Make it a block element */
            width: fit-content; /* Adjust width to content */
            margin: 30px auto 0; /* Center it below the content */
            padding: 12px 25px;
            background-color: #ef4444; /* Red for logout */
            color: white;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1.125rem;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            border: none;
            box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3);
        }
        .btn-logout:hover {
            background-color: #dc2626;
            transform: translateY(-2px);
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 767px) {
            .account-container {
                padding: 20px;
            }
            .sidebar {
                width: 100%; /* Full width sidebar on small screens */
                padding: 20px;
            }
            .main-content {
                padding: 20px;
            }
            .main-content h2 {
                font-size: 1.75rem;
            }
            .sidebar-nav a {
                font-size: 0.95rem;
                padding: 10px 12px;
            }
            .dashboard-card {
                padding: 20px;
            }
        }

        /* Order History List Item Styling */
        .order-item {
            background-color: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .order-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .order-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #e2e8f0;
        }
        .order-item-header h3 {
            font-size: 1.15rem;
            font-weight: 600;
            color: #333;
        }
        .order-item-header .order-date {
            font-size: 0.9rem;
            color: #777;
        }
        .order-item-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .order-item-details p {
            font-size: 0.95rem;
            color: #555;
        }
        .order-item-details .order-status {
            font-weight: 600;
            color: #6366f1; /* Primary color */
        }
        .order-item-details .order-total {
            font-weight: 700;
            font-size: 1.1rem;
            color: #333;
        }
        .order-item-products {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .order-item-product-img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid #eee;
        }
    </style>
</head>
<body>
    <!-- Main Header (copied from index.html to keep consistent navigation) -->
    <header class="main-header">
        <div class="container">
            <a href="index.html" class="logo">SHOPRIT<span>.</span></a>
            <nav class="main-nav">
                <ul class="nav-list">
                    <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
                    <li class="nav-item"><a href="products.html" class="nav-link">Products</a></li>
                    <li class="nav-item account-icon">
                        <a href="account.html" class="nav-link" id="accountLink">
                            ðŸ‘¤ Account <span id="accountStatus"></span>
                        </a>
                    </li>
                    <li class="nav-item cart-icon">
                        <a href="cart.html" class="nav-link">
                            ðŸ›’ Cart <span class="cart-count" id="cart-item-count">(0)</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <button class="menu-toggle" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <main class="account-container">
        <div class="account-dashboard">
            <!-- Sidebar Navigation -->
            <aside class="sidebar">
                <div class="sidebar-profile">
                    <div class="profile-avatar">
                        <!-- Placeholder for user avatar or initial -->
                        <img src="https://placehold.co/100x100/6366f1/ffffff?text=U" alt="User Avatar" onerror="this.onerror=null; this.src='https://placehold.co/100x100/6366f1/ffffff?text=U';">
                    </div>
                    <h3 class="profile-name" id="profileName">User Name</h3>
                    <p class="profile-email" id="profileEmail">user@example.com</p>
                </div>

                <nav class="sidebar-nav">
                    <ul>
                        <li><a href="#" class="nav-item active" data-tab="dashboard">Dashboard</a></li>
                        <li><a href="#" class="nav-item" data-tab="orders">Order History</a></li>
                        <li><a href="#" class="nav-item" data-tab="cancelledOrders">Cancelled Orders</a></li>
                        <li><a href="#" class="nav-item" data-tab="profile">Profile Settings</a></li>
                        <li><a href="#" class="nav-item" data-tab="addresses">Saved Addresses</a></li>
                        <li><a href="#" class="nav-item" data-tab="wishlist">Wishlist</a></li>
                        <li><a href="#" class="nav-item" data-tab="coupons">Coupon Codes</a></li>
                        <li><a href="#" class="nav-item" data-tab="support">Support & Help</a></li>
                    </ul>
                </nav>
                <button id="logoutBtn" class="btn-logout">Logout</button>
            </aside>

            <!-- Main Content Area -->
            <section class="main-content">
                <!-- Dashboard Content -->
                <div id="dashboard" class="content-section active">
                    <h2>Dashboard Overview</h2>
                    <p class="text-gray-600 mb-6">Welcome back to your dashboard! Here's a quick summary of your account activity and key information.</p>
                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <h3>Total Orders</h3>
                            <p class="text-3xl font-bold text-primary-color" id="dashboardTotalOrders">0</p>
                            <p>Completed purchases</p>
                            <a href="orderlist.html" class="text-sm text-primary-color hover:underline mt-2 inline-block">View Orders</a> <!-- LINK TO ORDERLIST.HTML -->
                        </div>
                        <div class="dashboard-card">
                            <h3>Pending Orders</h3>
                            <p class="text-3xl font-bold text-orange-500" id="dashboardPendingOrders">0</p>
                            <p>Orders awaiting shipment</p>
                            <a href="orderlist.html?status=Pending" class="text-sm text-primary-color hover:underline mt-2 inline-block">Track Orders</a> <!-- LINK TO ORDERLIST.HTML -->
                        </div>
                        <div class="dashboard-card">
                            <h3>Cancelled Orders</h3>
                            <p class="text-3xl font-bold text-red-500" id="dashboardCancelledOrders">0</p>
                            <p>Orders you've cancelled</p>
                            <a href="orderlist.html?status=Cancelled" class="text-sm text-primary-color hover:underline mt-2 inline-block">View Cancelled</a> <!-- LINK TO ORDERLIST.HTML -->
                        </div>
                        <div class="dashboard-card">
                            <h3>Wishlist Items</h3>
                            <p class="text-3xl font-bold text-green-500" id="dashboardWishlistItems">0</p>
                            <p>Products you've saved</p>
                            <a href="#" class="text-sm text-primary-color hover:underline mt-2 inline-block" data-tab-target="wishlist">View Wishlist</a>
                        </div>
                        <div class="dashboard-card">
                            <h3>Account Status</h3>
                            <p class="text-3xl font-bold text-blue-500" id="dashboardAccountStatus">Active</p>
                            <p>Your account is in good standing</p>
                        </div>
                        <div class="dashboard-card">
                            <h3>Last Login</h3>
                            <p class="text-xl font-bold text-gray-700" id="dashboardLastLogin">N/A</p>
                            <p>Your most recent activity</p>
                        </div>
                        <div class="dashboard-card">
                            <h3>Coupon Codes</h3>
                            <p class="text-3xl font-bold text-purple-500" id="dashboardCouponCodes">0</p>
                            <p>Available discounts</p>
                            <a href="#" class="text-sm text-primary-color hover:underline mt-2 inline-block" data-tab-target="coupons">View Coupons</a>
                        </div>
                        <div class="dashboard-card col-span-full md:col-span-1">
                            <h3>Quick Actions</h3>
                            <div class="flex flex-col gap-2 mt-2">
                                <a href="products.html" class="btn btn-primary btn-sm">Continue Shopping</a>
                                <a href="#" class="btn btn-secondary btn-sm" data-tab-target="profile">Edit Profile</a>
                                <a href="#" class="btn btn-secondary btn-sm" data-tab-target="support">Get Support</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Order History Content (Now less critical as orderlist.html handles main view) -->
                <div id="orders" class="content-section">
                    <h2>Order History</h2>
                    <p class="text-gray-600">Here are your past orders. For a full list, <a href="orderlist.html" class="text-primary-color hover:underline">click here</a>.</p>
                    <div id="orderHistoryList" class="mt-6 space-y-4">
                        <!-- Orders will be injected here by JavaScript -->
                        <p class="text-gray-700" id="noOrdersMessage" style="display: none;">You have no orders yet. Start shopping!</p>
                    </div>
                </div>


                <!-- Cancelled Orders Content (Placeholder) -->
                <div id="cancelledOrders" class="content-section">
                    <h2>Cancelled Orders</h2>
                    <p class="text-gray-600">Here you can find a list of your cancelled orders. For a full list, <a href="orderlist.html?status=Cancelled" class="text-primary-color hover:underline">click here</a>.</p>
                    <div id="cancelledOrderList" class="mt-6 space-y-4">
                        <p class="text-gray-700" id="noCancelledOrdersMessage" style="display: none;">You have no cancelled orders.</p>
                    </div>
                </div>

                <!-- Profile Settings Content (Placeholder) -->
                <div id="profile" class="content-section">
                    <h2>Profile Settings</h2>
                    <p class="text-gray-600">Update your personal information.</p>
                    <form class="mt-6">
                        <div class="form-group">
                            <label for="editName">Name</label>
                            <input type="text" id="editName" value="User Name">
                        </div>
                        <div class="form-group">
                            <label for="editEmail">Email</label>
                            <input type="email" id="editEmail" value="user@example.com" disabled>
                        </div>
                        <div class="form-group">
                            <label for="editPassword">New Password</label>
                            <input type="password" id="editPassword" placeholder="Leave blank to keep current">
                        </div>
                        <button type="submit" class="btn btn-primary mt-4">Save Changes</button>
                    </form>
                </div>

                <!-- Saved Addresses Content (Placeholder) -->
                <div id="addresses" class="content-section">
                    <h2>Saved Addresses</h2>
                    <p class="text-gray-600">Manage your shipping and billing addresses.</p>
                    <div class="mt-6 p-4 bg-gray-50 rounded-lg text-gray-700">
                        <p>No saved addresses. Add one for faster checkout!</p>
                    </div>
                    <button class="btn btn-secondary mt-6">Add New Address</button>
                </div>

                <!-- Wishlist Content (Placeholder) -->
                <div id="wishlist" class="content-section">
                    <h2>My Wishlist</h2>
                    <p class="text-gray-600">Your favorite products saved for later.</p>
                    <div class="mt-6 p-4 bg-gray-50 rounded-lg text-gray-700">
                        <p>Your wishlist is empty. Start adding products!</p>
                    </div>
                </div>

                <!-- Coupon Codes Content (Placeholder) -->
                <div id="coupons" class="content-section">
                    <h2>Coupon Codes</h2>
                    <p class="text-gray-600">Here are your available discount codes.</p>
                    <div class="mt-6 p-4 bg-gray-50 rounded-lg text-gray-700">
                        <p id="noCouponsMessage">No coupon codes available at the moment.</p>
                        <div id="couponList" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <!-- Coupon codes will be dynamically added here -->
                        </div>
                    </div>
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">Have a new code?</h3>
                        <div class="flex gap-2">
                            <input type="text" id="newCouponInput" placeholder="Enter coupon code" class="flex-grow p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-color">
                            <button id="applyCouponBtn" class="btn btn-primary">Apply</button>
                        </div>
                        <div class="error-message mt-2" id="couponErrorMessage"></div>
                    </div>
                </div>

                <!-- Support & Help Content (Placeholder) -->
                <div id="support" class="content-section">
                    <h2>Support & Help</h2>
                    <p class="text-gray-600 mb-6">Need assistance? Find answers to common questions or contact our support team.</p>
                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <h3>FAQs</h3>
                            <p>Find answers to frequently asked questions.</p>
                            <a href="#" class="text-sm text-primary-color hover:underline mt-2 inline-block">Browse FAQs</a>
                        </div>
                        <div class="dashboard-card">
                            <h3>Contact Support</h3>
                            <p>Reach out to our customer service team.</p>
                            <a href="#" class="text-sm text-primary-color hover:underline mt-2 inline-block">Contact Us</a>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer (copy from index.html to keep consistent footer) -->
    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-col about-col">
                    <h3>SHOPRIT</h3>
                    <p>Your one-stop destination for quality products and exceptional service. We're passionate about what we do.</p>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="products.html">Products</a></li>
                        <li><a href="privacy.html">Privacy Policy</a></li>
                        <li><a href="terms.html">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Connect With Us</h4>
                    <ul class="social-links flex space-x-4 mt-2">
                        <li>
                            <a href="https://www.instagram.com/shoprit.io/" target="_blank" rel="noopener noreferrer" class="text-white hover:text-accent-light transition-colors duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-instagram">
                                    <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                                </svg>
                                <span class="sr-only">Instagram</span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.linkedin.com/in/hemang-khatri-846b14325/" target="_blank" rel="noopener noreferrer" class="text-white hover:text-accent-light transition-colors duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-linkedin">
                                    <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
                                </svg>
                                <span class="sr-only">LinkedIn</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" target="_blank" rel="noopener noreferrer" class="text-white hover:text-accent-light transition-colors duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-facebook">
                                    <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                                </svg>
                                <span class="sr-only">Facebook</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; <span id="current-year"></span> SHOPRIT. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Link to your main script.js for shared functions and new auth logic -->
    <script src="scripts/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // âœ… Define this at the top so it's available everywhere
            const loggedInUser = window.getLoggedInUser();

            const sidebarNavLinks = document.querySelectorAll('.sidebar-nav a');
            const contentSections = document.querySelectorAll('.main-content .content-section');
            const profileNameElement = document.getElementById('profileName');
            const profileEmailElement = document.getElementById('profileEmail');
            const editNameInput = document.getElementById('editName');
            const editEmailInput = document.getElementById('editEmail');

            const dashboardTotalOrders = document.getElementById('dashboardTotalOrders');
            const dashboardPendingOrders = document.getElementById('dashboardPendingOrders');
            const dashboardCancelledOrders = document.getElementById('dashboardCancelledOrders');
            const dashboardWishlistItems = document.getElementById('dashboardWishlistItems');
            const dashboardLastLogin = document.getElementById('dashboardLastLogin');
            const dashboardCouponCodes = document.getElementById('dashboardCouponCodes');

            const noCouponsMessage = document.getElementById('noCouponsMessage');
            const couponListContainer = document.getElementById('couponList');
            const newCouponInput = document.getElementById('newCouponInput');
            const applyCouponBtn = document.getElementById('applyCouponBtn');
            const couponErrorMessage = document.getElementById('couponErrorMessage');

            const orderHistoryList = document.getElementById('orderHistoryList');
            const noOrdersMessage = document.getElementById('noOrdersMessage');
            const cancelledOrderList = document.getElementById('cancelledOrderList');
            const noCancelledOrdersMessage = document.getElementById('noCancelledOrdersMessage');


            // âœ… Fix: Make sure avatar doesn't break if loggedInUser is null
            const avatarImg = document.querySelector('.profile-avatar img');
            if (avatarImg && loggedInUser && loggedInUser.name) {
                const initial = loggedInUser.name[0].toUpperCase();
                avatarImg.src = `https://placehold.co/100x100/6366f1/ffffff?text=${initial}`;
            }

            function showContentTab(tabId) {
                contentSections.forEach(section => section.classList.remove('active'));
                sidebarNavLinks.forEach(link => link.classList.remove('active'));

                const activeSection = document.getElementById(tabId);
                if (activeSection) {
                    activeSection.classList.add('active');
                    const activeNavItem = document.querySelector(`.sidebar-nav a[data-tab="${tabId}"]`);
                    if (activeNavItem) activeNavItem.classList.add('active');
                }
            }

            function renderCouponCodes() {
                if (loggedInUser && loggedInUser.couponCodes?.length > 0) {
                    noCouponsMessage.style.display = 'none';
                    couponListContainer.innerHTML = '';
                    loggedInUser.couponCodes.forEach(coupon => {
                        const div = document.createElement('div');
                        div.className = 'bg-white p-4 rounded-lg shadow-sm flex justify-between items-center';
                        div.innerHTML = `
                            <span class="font-bold text-lg text-purple-700">${coupon}</span>
                            <button class="text-sm text-primary-color hover:underline"
                              onclick="navigator.clipboard.writeText('${coupon}').then(() => showMessage('Copied!', 'info')).catch(err => console.error('Could not copy text: ', err));">
                              Copy
                            </button>`;
                        couponListContainer.appendChild(div);
                    });
                } else {
                    noCouponsMessage.style.display = 'block';
                    couponListContainer.innerHTML = '';
                }
            }

            // Function to render order history (for the inline tab)
            function renderOrderHistory() {
                if (loggedInUser && loggedInUser.orders?.length > 0) {
                    noOrdersMessage.style.display = 'none';
                    orderHistoryList.innerHTML = ''; // Clear previous orders
                    // Sort orders by date, newest first
                    const sortedOrders = [...loggedInUser.orders].sort((a, b) => new Date(b.date) - new Date(a.date));

                    // Show only a limited number of orders in the inline tab, e.g., first 3
                    sortedOrders.slice(0, 3).forEach(order => {
                        const orderItem = document.createElement('a'); // Use <a> for clickable
                        orderItem.href = `order-detail.html?orderId=${order.orderId}`; // Link to detail page
                        orderItem.className = 'order-item'; // Apply styling
                        orderItem.innerHTML = `
                            <div class="order-item-header">
                                <h3>Order #${order.orderId}</h3>
                                <span class="order-date">${new Date(order.date).toLocaleDateString()}</span>
                            </div>
                            <div class="order-item-details">
                                <p>Total: <span class="order-total">â‚¹${order.total.toFixed(2)}</span></p>
                                <p>Status: <span class="order-status">${order.status}</span></p>
                                ${order.status !== 'Cancelled' ? `
                                  <button class="btn btn-secondary btn-sm cancel-order-btn mt-2" data-order-id="${order.orderId}">Cancel Order</button>
                                ` : ''}
                            </div>
                            <div class="order-item-products">
                                ${order.items.slice(0, 3).map(item => `
                                    <img src="${item.image}" alt="${item.name}" class="order-item-product-img" onerror="this.onerror=null; this.src='https://placehold.co/50x50/e2e8f0/6366f1?text=No+Image';">
                                `).join('')}
                                ${order.items.length > 3 ? `<span class="text-gray-500 text-sm ml-2">+${order.items.length - 3} more</span>` : ''}
                            </div>
                        `;
                        orderHistoryList.appendChild(orderItem);
                    });
                } else {
                    noOrdersMessage.style.display = 'block';
                    orderHistoryList.innerHTML = '';
                }
            }

            // Function to render cancelled orders (for the inline tab)
            function renderCancelledOrders() {
                const cancelledOrders = loggedInUser.orders?.filter(order => order.status === 'Cancelled') || [];
                if (cancelledOrders.length > 0) {
                    noCancelledOrdersMessage.style.display = 'none';
                    cancelledOrderList.innerHTML = '';
                    cancelledOrders.slice(0, 3).forEach(order => { // Show limited cancelled orders
                        const orderItem = document.createElement('a');
                        orderItem.href = `order-detail.html?orderId=${order.orderId}`;
                        orderItem.className = 'order-item';
                        orderItem.innerHTML = `
                            <div class="order-item-header">
                                <h3>Order #${order.orderId}</h3>
                                <span class="order-date">${new Date(order.date).toLocaleDateString()}</span>
                            </div>
                            <div class="order-item-details">
                                <p>Total: <span class="order-total">â‚¹${order.total.toFixed(2)}</span></p>
                                <p>Status: <span class="order-status text-red-500">${order.status}</span></p>
                            </div>
                            <div class="order-item-products">
                                ${order.items.slice(0, 3).map(item => `
                                    <img src="${item.image}" alt="${item.name}" class="order-item-product-img" onerror="this.onerror=null; this.src='https://placehold.co/50x50/e2e8f0/6366f1?text=No+Image';">
                                `).join('')}
                                ${order.items.length > 3 ? `<span class="text-gray-500 text-sm ml-2">+${order.items.length - 3} more</span>` : ''}
                            </div>
                        `;
                        cancelledOrderList.appendChild(orderItem);
                    });
                } else {
                    noCancelledOrdersMessage.style.display = 'block';
                    cancelledOrderList.innerHTML = '';
                }
            }


            // Event listeners for sidebar navigation
            sidebarNavLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabId = link.dataset.tab;
                    showContentTab(tabId);
                    if (tabId === 'coupons') renderCouponCodes();
                    if (tabId === 'orders') renderOrderHistory();
                    if (tabId === 'cancelledOrders') renderCancelledOrders();
                });
            });

            // Event listeners for quick links within the dashboard cards
            // NOTE: The "View Orders", "Track Orders", "View Cancelled" links are now direct hrefs to orderlist.html
            // So, only internal data-tab-target links need this listener.
            document.querySelectorAll('.dashboard-card a[data-tab-target]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetTabId = link.dataset.tabTarget;
                    showContentTab(targetTabId);
                    if (targetTabId === 'coupons') renderCouponCodes();
                    if (targetTabId === 'orders') renderOrderHistory();
                    if (targetTabId === 'cancelledOrders') renderCancelledOrders();
                });
            });


            // Update profile info and dashboard stats on load
            if (loggedInUser) {
                profileNameElement.textContent = loggedInUser.name || 'User Name';
                profileEmailElement.textContent = loggedInUser.email || 'user@example.com';
                if (editNameInput) editNameInput.value = loggedInUser.name || '';
                if (editEmailInput) editEmailInput.value = loggedInUser.email || '';

                // Initialize dashboard data if not present (for new users or first login)
                loggedInUser.orders ??= []; // Initialize orders array
                loggedInUser.totalOrders = loggedInUser.orders.length;
                loggedInUser.pendingOrders = loggedInUser.orders.filter(order => order.status === 'Pending' || order.status === 'Shipped' || order.status === 'Out for Delivery').length;
                loggedInUser.cancelledOrders = loggedInUser.orders.filter(order => order.status === 'Cancelled').length;
                loggedInUser.wishlistItems ??= 0;
                loggedInUser.lastLogin ??= 'N/A';
                loggedInUser.couponCodes ??= [];

                if (dashboardTotalOrders) dashboardTotalOrders.textContent = loggedInUser.totalOrders;
                if (dashboardPendingOrders) dashboardPendingOrders.textContent = loggedInUser.pendingOrders;
                if (dashboardCancelledOrders) dashboardCancelledOrders.textContent = loggedInUser.cancelledOrders;
                if (dashboardWishlistItems) dashboardWishlistItems.textContent = loggedInUser.wishlistItems;
                if (dashboardLastLogin) dashboardLastLogin.textContent = loggedInUser.lastLogin !== 'N/A' ? new Date(loggedInUser.lastLogin).toLocaleString() : 'N/A';
                if (dashboardCouponCodes) dashboardCouponCodes.textContent = loggedInUser.couponCodes.length;

                // Update localStorage with any newly initialized data
                window.setLoggedInUser(loggedInUser);

            } else {
                window.showMessage('Please log in to view your account.', 'error');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 1000);
            }

            // Handle Profile Settings form submission (simulated)
            const profileSettingsForm = document.querySelector('#profile form');
            if (profileSettingsForm) {
                profileSettingsForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const newName = editNameInput.value;
                    const newPassword = document.getElementById('editPassword').value;

                    if (loggedInUser) {
                        loggedInUser.name = newName;
                        window.setLoggedInUser(loggedInUser);
                        profileNameElement.textContent = newName;
                        window.showMessage('Profile updated successfully!', 'success');
                    } else {
                        window.showMessage('Not logged in.', 'error');
                    }
                    document.getElementById('editPassword').value = '';
                });
            }

            // Handle Apply Coupon button click (simulated)
            if (applyCouponBtn) {
                applyCouponBtn.addEventListener('click', () => {
                    const couponCode = newCouponInput.value.trim().toUpperCase();
                    couponErrorMessage.textContent = '';

                    if (couponCode === '') {
                        couponErrorMessage.textContent = 'Please enter a coupon code.';
                        return;
                    }

                    const loggedInUser = window.getLoggedInUser();
                    if (loggedInUser) {
                        const validNewCoupons = ['NEWUSER25', 'SAVEBIG'];
                        if (validNewCoupons.includes(couponCode) && !loggedInUser.couponCodes.includes(couponCode)) {
                            loggedInUser.couponCodes.push(couponCode);
                            window.setLoggedInUser(loggedInUser);
                            window.showMessage(`Coupon "${couponCode}" applied!`, 'success');
                            newCouponInput.value = '';
                            renderCouponCodes();
                            if (dashboardCouponCodes) dashboardCouponCodes.textContent = loggedInUser.couponCodes.length;
                        } else if (loggedInUser.couponCodes.includes(couponCode)) {
                            couponErrorMessage.textContent = `Coupon "${couponCode}" is already in your list.`;
                        } else {
                            couponErrorMessage.textContent = `Coupon "${couponCode}" is invalid or expired.`;
                        }
                    } else {
                        window.showMessage('Please log in to apply coupons.', 'error');
                    }
                });
            }

            // Show dashboard by default on load
            showContentTab('dashboard');
            // Initial rendering of orders and cancelled orders for the inline tabs
            renderOrderHistory(); // This will show limited orders on the dashboard tab
            renderCancelledOrders(); // This will show limited cancelled orders on the dashboard tab
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
              logoutBtn.addEventListener('click', () => {
              localStorage.removeItem('shoprit_logged_in'); // ðŸ”‘ Clears login session
              window.showMessage('You have been logged out.', 'success');
              setTimeout(() => {
                window.location.href = 'login.html'; // ðŸ” Redirect to login page
            }, 1000);
          });
        }
        // âœ… Cancel Order button click logic (account.html - Order History section)
        orderHistoryList.addEventListener('click', (e) => {
          if (e.target.classList.contains('cancel-order-btn')) {
            e.preventDefault();
            const orderId = e.target.dataset.orderId;
            if (!orderId) return;

            const orderIndex = loggedInUser.orders.findIndex(o => o.orderId == orderId);
            if (orderIndex !== -1) {
              loggedInUser.orders[orderIndex].status = 'Cancelled';
              window.setLoggedInUser(loggedInUser);
              window.showMessage('Order cancelled successfully!', 'success');

      // âœ… Re-render both tabs to reflect change
              renderOrderHistory();
              renderCancelledOrders();
            }
          }
        });


        });
        // âœ… Logout Logic: Clear session and redirect to login

    </script>
</body>
</html>
